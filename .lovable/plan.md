

## 구문분석 반수동 모드: 드래그 + 힌트 입력 → AI 정리

### 현재 방식
텍스트 드래그 → "선택 구문분석" 클릭 → AI가 알아서 문법 포인트 생성

### 변경 후 방식
텍스트 드래그 → 팝업에 힌트 입력란 표시 → 사용자가 대략적인 포인트 입력 (예: "관계대명사 수식", "분사구문") → AI가 정리해서 구문분석에 추가

### 수정 파일

**1. `src/components/ChunkEditor.tsx`**
- 기존 "선택 구문분석" 버튼 클릭 시 바로 호출하던 것을 변경
- 클릭하면 선택된 텍스트 아래에 힌트 입력 필드(textarea + 전송 버튼) 표시
- 사용자가 힌트를 입력하고 전송하면 `onAnalyzeSelection(selectedText, userHint)`로 호출
- 힌트 없이 바로 전송도 가능 (기존처럼 AI 자동 생성)

**2. `src/pages/Index.tsx`**
- `handleGenerateSyntax` 함수에 `userHint` 파라미터 추가
- `grammar` 함수 호출 시 `userHint`도 함께 전달
- `onAnalyzeSelection` 콜백 시그니처 업데이트

**3. `supabase/functions/grammar/index.ts`**
- `userHint` 파라미터 수신
- 힌트가 있으면 시스템 프롬프트를 변경: "사용자가 지정한 포인트를 기반으로 정리만 해라"
- 힌트가 없으면 기존처럼 자동 생성

### UI 동작 상세

```text
[텍스트 드래그] → [선택 구문분석 버튼 클릭]
                         ↓
              ┌─────────────────────────────┐
              │ 선택: "which were conducted" │
              │                             │
              │ [힌트 입력란]               │
              │ "관계대명사 수식, 수동태"    │
              │                             │
              │ [정리하기]  [자동생성]       │
              └─────────────────────────────┘
                         ↓
              AI가 포맷 맞춰서 구문분석에 추가
```

- "정리하기": 사용자 힌트를 기반으로 AI가 템플릿에 맞게 정리
- "자동생성": 힌트 없이 기존처럼 AI가 알아서 분석 (기존 기능 유지)

### 프롬프트 변경 (`grammar` 함수)

힌트가 있을 때의 시스템 프롬프트:
- "사용자가 제시한 문법 포인트를 기존 출력 템플릿 형식으로 정리하라"
- "사용자가 언급하지 않은 포인트는 추가하지 말 것"
- "각 항목은 bullet(•)로 시작, 한 줄로 작성"

### 수정 파일 목록
- `src/components/ChunkEditor.tsx` (힌트 입력 UI 추가)
- `src/pages/Index.tsx` (콜백 시그니처 업데이트)
- `supabase/functions/grammar/index.ts` (힌트 기반 정리 모드 추가)

